sudo apt-get update
sudo apt-get install --no-install-recommends -y ubuntu-desktop gnome-panel gnome-settings-daemon metacity nautilus gnome-terminal gnome-core
sudo apt-get install -y vnc4server
sudo cp /usr/bin/vncserver /usr/bin/vncserver.bkp
sudo rm -rf /usr/bin/vncserver
sudo base64 -di > /usr/bin/vncserver <<< 'IyEvdXNyL2Jpbi9lbnYgcGVybAojCiMgIENvcHlyaWdodCAoQykgMjAwNC0yMDA2IE9sYSBMdW5kcXZpc3QgPG9wYWxAZGViaWFuLm9yZz4KIyAgQ29weXJpZ2h0IChDKSAyMDAyLTIwMDUgUmVhbFZOQyBMdGQuCiMgIENvcHlyaWdodCAoQykgMTk5OSBBVCZUIExhYm9yYXRvcmllcyBDYW1icmlkZ2UuICBBbGwgUmlnaHRzIFJlc2VydmVkLgojCiMgIFRoaXMgaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQojICBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQojICB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIgdmVyc2lvbiAyIG9mIHRoZSBMaWNlbnNlLCBvcgojICAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgojCiMgIFRoaXMgc29mdHdhcmUgaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKIyAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKIyAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQojICBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgojCiMgIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCiMgIGFsb25nIHdpdGggdGhpcyBzb2Z0d2FyZTsgaWYgbm90LCB3cml0ZSB0byB0aGUgRnJlZSBTb2Z0d2FyZQojICBGb3VuZGF0aW9uLCBJbmMuLCA1OSBUZW1wbGUgUGxhY2UgLSBTdWl0ZSAzMzAsIEJvc3RvbiwgTUEgIDAyMTExLTEzMDcsCiMgIFVTQS4KIwoKIwojIHZuY3NlcnZlciAtIHdyYXBwZXIgc2NyaXB0IHRvIHN0YXJ0IGFuIFggVk5DIHNlcnZlci4KIwoKIyBUaGlzIGZpbGUgd2FzIGhlYXZpbHkgZWRpdGVkIGJ5IE9sYSBMdW5kcXZpc3QgPG9wYWxAZGViaWFuLm9yZz4gdXNpbmcKIyBvcHRpb25zIGZyb20gdm5jIHBhY2thZ2UuCiMgTW9zdCBtb2RpZmljYXRpb25zIGFyZSB3cml0dGVuIGJ5IE1hcmN1cy5Ccmlua21hbm5AcnVoci11bmktYm9jaHVtLmRlIGFuZAojIG5vdyBpbmNvcnBvcmF0ZWQgYnkgT2xhLgoKIyBQbGVhc2UgcmVwb3J0IGFsbCBlcnJvcnMgdG8gRGViaWFuIGFuZCBub3QgdG8gT1JMLgoKIwojIEZpcnN0IG1ha2Ugc3VyZSB3ZSdyZSBvcGVyYXRpbmcgaW4gYSBzYW5lIGVudmlyb25tZW50LgojCgomU2FuaXR5Q2hlY2soKTsKCiMKIyBHbG9iYWwgdmFyaWFibGVzLiAgWW91IG1heSB3YW50IHRvIGNvbmZpZ3VyZSBzb21lIG9mIHRoZXNlIGZvciB5b3VyIHNpdGUuCiMKCiRnZW9tZXRyeSA9ICIxMDI0eDc2OCI7CiRkZXB0aCA9IDE2Owokdm5jSmF2YUZpbGVzID0gKCgoLWQgIi91c3Ivc2hhcmUvdm5jLWphdmEiKSAmJiAiL3Vzci9zaGFyZS92bmMtamF2YSIpIHx8CgkJICgoLWQgIi91c3Ivc2hhcmUvdm5jL2NsYXNzZXMiKSAmJiAiL3Vzci9zaGFyZS92bmMvY2xhc3NlcyIpIHx8CiAgICAgICAgICAgICAgICAgKCgtZCAiL3Vzci9sb2NhbC92bmMvY2xhc3NlcyIpICYmICIvdXNyL2xvY2FsL3ZuYy9jbGFzc2VzIikpOwoKJHZuY1VzZXJEaXIgPSAiJEVOVntIT01FfS8udm5jIjsKJHhhdXRob3JpdHlGaWxlID0gIiRFTlZ7WEFVVEhPUklUWX0iIHx8ICIkRU5We0hPTUV9Ly5YYXV0aG9yaXR5IjsKCiRkZWZhdWx0WFN0YXJ0dXAKICAgID0gKCIjIS9iaW4vc2hcblxuIi4KICAgICAgICIjIFVuY29tbWVudCB0aGUgZm9sbG93aW5nIHR3byBsaW5lcyBmb3Igbm9ybWFsIGRlc2t0b3A6XG4iLgogICAgICAgIiMgdW5zZXQgU0VTU0lPTl9NQU5BR0VSXG4iLgogICAgICAgIiMgZXhlYyAvZXRjL1gxMS94aW5pdC94aW5pdHJjXG5cbiIuCiAgICAgICAiZ25vbWUtcGFuZWwgJm4iLgogICAgICAgImdub21lLXNldHRpbmdzLWRhZW1vbiAmbiIuCiAgICAgICAibWV0YWNpdHkgJm4iLgogICAgICAgIm5hdXRpbHVzICZuIi4KICAgICAgICJnbm9tZS10ZXJtaW5hbCAmbiIuCiAgICAgICAiWyAteCAvZXRjL3ZuYy94c3RhcnR1cCBdICYmIGV4ZWMgL2V0Yy92bmMveHN0YXJ0dXBcbiIuCiAgICAgICAiWyAtciBcJEhPTUUvLlhyZXNvdXJjZXMgXSAmJiB4cmRiIFwkSE9NRS8uWHJlc291cmNlc1xuIi4KICAgICAgICJ4c2V0cm9vdCAtc29saWQgZ3JleVxuIi4KICAgICAgICJ2bmNjb25maWcgLWljb25pYyAmXG4iLgogICAgICAgIngtdGVybWluYWwtZW11bGF0b3IgLWdlb21ldHJ5IDgweDI0KzEwKzEwIC1scyAtdGl0bGUgXCJcJFZOQ0RFU0tUT1AgRGVza3RvcFwiICZcbiIuCiAgICAgICAieC13aW5kb3ctbWFuYWdlciAmXG4iKTsKCiMjIyMjIyMjIEFkZGluZyBjb25maWd1cmF0aW9uIHBvc3NpYmlsaXR5ICMjIyMjIyMjIyMjIyMjIyMKJENvbmZpZ19maWxlID0gIi9ldGMvdm5jLmNvbmYiOwomUmVhZENvbmZpZ0ZpbGUoKTsKJENvbmZpZ19maWxlID0gIiRFTlZ7SE9NRX0vLnZuY3JjIjsKJlJlYWRDb25maWdGaWxlKCk7CgppZiAoISRYRkNvbmZpZ1BhdGgpIHsKICBmb3JlYWNoICgiL2V0Yy9YMTEveG9yZy5jb25mIiwgIi9ldGMvWDExL1hGODZDb25maWctNCIsICIvZXRjL1gxMS9YRjg2Q29uZmlnIiApewogICAgJFhGQ29uZmlnUGF0aCA9ICRfOwogICAgbGFzdCBpZiAoIC1lICRYRkNvbmZpZ1BhdGggKTsKICB9Cn0KaWYgKCEkZm9udFBhdGgpIHsKICAmUmVhZFhGQ29uZmlnRm9udDsKfQppZiAoISRmb250UGF0aCkgewogICRmb250UGF0aCA9ICIvdXNyL1gxMVI2L2xpYi9YMTEvZm9udHMvVHlwZTEvLCIuCiAgICAgICAgICAgICAgIi91c3IvWDExUjYvbGliL1gxMS9mb250cy9TcGVlZG8vLCIuCiAgICAgICAgICAgICAgIi91c3IvWDExUjYvbGliL1gxMS9mb250cy9taXNjLywiLgogICAgICAgICAgICAgICIvdXNyL1gxMVI2L2xpYi9YMTEvZm9udHMvNzVkcGkvLCIuCiAgICAgICAgICAgICAgIi91c3IvWDExUjYvbGliL1gxMS9mb250cy8xMDBkcGkvLCIuCiAgICAgICAgICAgICAgIi91c3Ivc2hhcmUvZm9udHMvWDExL21pc2MvLCIuCiAgICAgIAkgICAgICAiL3Vzci9zaGFyZS9mb250cy9YMTEvVHlwZTEvLCIuCiAgICAgICAgICAgICAgIi91c3Ivc2hhcmUvZm9udHMvWDExLzc1ZHBpLywiLgogICAgICAgICAgICAgICIvdXNyL3NoYXJlL2ZvbnRzL1gxMS8xMDBkcGkvIgp9CmlmICghJGNvbG9yUGF0aCkgewogICZSZWFkWEZDb25maWdDb2xvcjsKfQppZiAoISRjb2xvclBhdGgpIHsKICBmb3JlYWNoICgiL2V0Yy9YMTEvcmdiIiwgIi91c3Ivc2hhcmUvWDExL3JnYiIsICIvdXNyL1gxMVI2L2xpYi9YMTEvcmdiIil7CiAgICAgICRjb2xvclBhdGggPSAkXzsKICAgICAgbGFzdCBpZiAoIC1lICIke2NvbG9yUGF0aH0udHh0IiApOwogIH0KfQoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKJHZuY1VzZXJEaXJVbmRlclRtcCA9ICgkdm5jVXNlckRpciA9fiBtfF4vdG1wLy4rfCkgPyAxIDogMDsKJHhzdGFydHVwID0gKCR2bmNVc2VyRGlyVW5kZXJUbXApID8KICAiJEVOVntIT01FfS8udm5jc3RhcnR1cCIgOiAiJHZuY1VzZXJEaXIveHN0YXJ0dXAiOwokeHN0YXJ0dXAgPSAkdm5jU3RhcnR1cCBpZiAoJHZuY1N0YXJ0dXApOwoKdW5sZXNzICgkeGF1dGhvcml0eUZpbGUpIHsKICAgIGlmICgkdm5jVXNlckRpclVuZGVyVG1wKSB7CiAgICAgICAgJHhhdXRob3JpdHlGaWxlID0gIiR2bmNVc2VyRGlyLy5YYXV0aG9yaXR5IjsKICAgIH0gZWxzZSB7CiAgICAgICAgJHhhdXRob3JpdHlGaWxlID0gIiRFTlZ7SE9NRX0vLlhhdXRob3JpdHkiOwogICAgfQp9CgpjaG9wKCRob3N0ID0gYHVuYW1lIC1uYCk7CgoKIyBDaGVjayBjb21tYW5kIGxpbmUgb3B0aW9ucwoKJlBhcnNlT3B0aW9ucygiLWdlb21ldHJ5IiwxLCItZGVwdGgiLDEsIi1waXhlbGZvcm1hdCIsMSwiLW5hbWUiLDEsIi1raWxsIiwxLAoJICAgICAgIi1oZWxwIiwwLCItaCIsMCwiLS1oZWxwIiwwLAoJICAgICAgIi1jbGVhbiIsMCwgIi1mcCIsMSwKCSAgICAgICItYWx3YXlzc2hhcmVkIiwwLCAiLW5ldmVyc2hhcmVkIiwwLAoJICAgICAgIi1odHRwcG9ydCIsMSwiLWJhc2VodHRwcG9ydCIsMSk7CgomVXNhZ2UoKSBpZiAoJG9wdHsnLWhlbHAnfSB8fCAkb3B0eyctaCd9IHx8ICRvcHR7Jy0taGVscCd9KTsKCiZLaWxsKCkgaWYgKCRvcHR7Jy1raWxsJ30pOwoKJHVzZUNsYXNzZXMgPSAwOwppZiAoZGVmaW5lZCAkdm5jSmF2YUZpbGVzKSB7CiAgaWYoLWQgJHZuY0phdmFGaWxlcykgewogICAgICAkdXNlQ2xhc3NlcyA9IDE7CiAgfQp9CgojIFVuY29tbWVudCB0aGlzIGxpbmUgaWYgeW91IHdhbnQgZGVmYXVsdCBnZW9tZXRyeSwgZGVwdGggYW5kIHBpeGVsZm9ybWF0CiMgdG8gbWF0Y2ggdGhlIGN1cnJlbnQgWCBkaXNwbGF5OgojICZHZXRYRGlzcGxheURlZmF1bHRzKCk7CgppZiAoJG9wdHsnLWdlb21ldHJ5J30pIHsKICAgICRnZW9tZXRyeSA9ICRvcHR7Jy1nZW9tZXRyeSd9Owp9CmlmICgkb3B0eyctZGVwdGgnfSkgewogICAgJGRlcHRoID0gJG9wdHsnLWRlcHRoJ307CiAgICAkcGl4ZWxmb3JtYXQgPSAiIjsKfQppZiAoJG9wdHsnLXBpeGVsZm9ybWF0J30pIHsKICAgICRwaXhlbGZvcm1hdCA9ICRvcHR7Jy1waXhlbGZvcm1hdCd9Owp9CgppZiAoJG9wdHsnLWZwJ30pIHsKICAgIEBmb250UGF0aEVsZW1lbnRzID0gc3BsaXQoL1xzKixccyovLCAiJG9wdHsnLWZwJ30iKTsKCiAgICAkZm9udFBhdGggPSAnJzsKCiAgICBmb3JlYWNoICRpICgwLi4iJCNmb250UGF0aEVsZW1lbnRzIikgewogICAgICAgJHRlbXBGb250UGF0aCA9ICRmb250UGF0aEVsZW1lbnRzWyRpXTsKICAgICAgIGlmICgkdGVtcEZvbnRQYXRoICF+IG0hXlteL10qL1teL10qOlxkKyQhKSB7CiAgICAgICAgICAgJHRlbXBGb250UGF0aCA9fiBzLzp1bnNjYWxlZCQvLzsKICAgICAgICAgICBpZiAoLXIgIiR0ZW1wRm9udFBhdGgvZm9udHMuZGlyIikgewogICAgICAgICAgICAgICAkZm9udFBhdGggLj0gIiRmb250UGF0aEVsZW1lbnRzWyRpXSwiOwogICAgICAgICAgIH0KICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgJGZvbnRQYXRoIC49ICIkZm9udFBhdGhFbGVtZW50c1skaV0sIjsKICAgICAgIH0KICAgIH0KICAgIGNob3AgJGZvbnRQYXRoOwp9CgomQ2hlY2tHZW9tZXRyeUFuZERlcHRoKCk7CgojIENyZWF0ZSB0aGUgdXNlcidzIHZuYyBkaXJlY3RvcnkgaWYgbmVjZXNzYXJ5LgoKaWYgKCEoLWUgJHZuY1VzZXJEaXIpKSB7CiAgICBpZiAoIW1rZGlyKCR2bmNVc2VyRGlyLDA3NTUpKSB7CglkaWUgIiRwcm9nOiBDb3VsZCBub3QgY3JlYXRlICR2bmNVc2VyRGlyLlxuIjsKICAgIH0KfQoKKCR6LCR6LCRtb2RlKSA9IHN0YXQoIiR2bmNVc2VyRGlyIik7CmlmICghLWQgXyB8fCAhLW8gXyB8fCAoJHZuY1VzZXJEaXJVbmRlclRtcCAmJiAoJG1vZGUgJiAwNzc3KSAhPSAwNzAwKSkgewogICAgZGllICIkcHJvZzogV3JvbmcgdHlwZSBvciBhY2Nlc3MgbW9kZSBvZiAkdm5jVXNlckRpci5cbiI7Cn0KCiMgTWFrZSBzdXJlIHRoZSB1c2VyIGhhcyBhIHBhc3N3b3JkLgoKKCR6LCR6LCRtb2RlKSA9IHN0YXQoIiR2bmNVc2VyRGlyL3Bhc3N3ZCIpOwppZiAoISgtZSAiJHZuY1VzZXJEaXIvcGFzc3dkIikgfHwgKCRtb2RlICYgMDc3KSkgewogICAgd2FybiAiXG5Zb3Ugd2lsbCByZXF1aXJlIGEgcGFzc3dvcmQgdG8gYWNjZXNzIHlvdXIgZGVza3RvcHMuXG5cbiI7CiAgICBzeXN0ZW0oInZuY3Bhc3N3ZCAkdm5jVXNlckRpci9wYXNzd2QiKTsgCiAgICBpZiAoKCQ/ID4+IDgpICE9IDApIHsKCWV4aXQgMTsKICAgIH0KfQoKIyBGaW5kIGRpc3BsYXkgbnVtYmVyLgoKaWYgKChAQVJHViA+IDApICYmICgkQVJHVlswXSA9fiAvXjooXGQrKSQvKSkgewogICAgJGRpc3BsYXlOdW1iZXIgPSAkMTsKICAgIHNoaWZ0KEBBUkdWKTsKICAgIGlmICghJkNoZWNrRGlzcGxheU51bWJlcigkZGlzcGxheU51bWJlcikpIHsKCWRpZSAiQSBWTkMgc2VydmVyIGlzIGFscmVhZHkgcnVubmluZyBhcyA6JGRpc3BsYXlOdW1iZXJcbiI7CiAgICB9Cn0gZWxzaWYgKChAQVJHViA+IDApICYmICgkQVJHVlswXSAhfiAvXi0vKSkgewogICAgJlVzYWdlKCk7Cn0gZWxzZSB7CiAgICAkZGlzcGxheU51bWJlciA9ICZHZXREaXNwbGF5TnVtYmVyKCk7Cn0KCiR2bmNQb3J0ID0gNTkwMCArICRkaXNwbGF5TnVtYmVyOwoKJGRlc2t0b3BMb2cgPSAiJHZuY1VzZXJEaXIvJGhvc3Q6JGRpc3BsYXlOdW1iZXIubG9nIjsKdW5saW5rKCRkZXNrdG9wTG9nKTsKCiMgTWFrZSBhbiBYIHNlcnZlciBjb29raWUgLSB1c2UgbWNvb2tpZQokY29va2llID0gYC91c3IvYmluL21jb29raWVgOwpvcGVuIChYQVVUSCwgInx4YXV0aCAtZiAkeGF1dGhvcml0eUZpbGUgc291cmNlIC0iKTsKcHJpbnQgWEFVVEggImFkZCAkaG9zdDokZGlzcGxheU51bWJlciAuICRjb29raWVcbiI7CnByaW50IFhBVVRIICJhZGQgJGhvc3QvdW5peDokZGlzcGxheU51bWJlciAuICRjb29raWVcbiI7CmNsb3NlIFhBVVRIOwoKaWYgKCRvcHR7Jy1uYW1lJ30pIHsKICAgICRkZXNrdG9wTmFtZSA9ICRvcHR7Jy1uYW1lJ307Cn0gZWxzZSB7CiAgICAkZGVza3RvcE5hbWUgPSAiJGhvc3Q6JGRpc3BsYXlOdW1iZXIgKCRFTlZ7VVNFUn0pIjsKfQoKIyBOb3cgc3RhcnQgdGhlIFggVk5DIFNlcnZlcgoKJGNtZCA9ICJYdm5jNCA6JGRpc3BsYXlOdW1iZXIiOwokY21kIC49ICIgLWRlc2t0b3AgIiAuICZxdW90ZWRTdHJpbmcoJGRlc2t0b3BOYW1lKTsKaWYgKCR1c2VDbGFzc2VzKSB7CiAgJGNtZCAuPSAiIC1odHRwZCAkdm5jSmF2YUZpbGVzIjsKICBwcmludCAoIkZvdW5kICR2bmNKYXZhRmlsZXMgZm9yIGh0dHAgY29ubmVjdGlvbnMuXG4iKTsKICBpZiAoJG9wdHsnLWh0dHBwb3J0J30pIHsKICAgICRjbWQgLj0gIiAtaHR0cHBvcnQgJG9wdHsnLWh0dHBwb3J0J30iOwogICAgcHJpbnQgKCJMaXN0ZW5pbmcgdG8gJG9wdHsnLWh0dHBwb3J0J30gZm9yIGh0dHAgY29ubmVjdGlvbnMuXG4iKTsKICB9CiAgZWxzaWYgKCRvcHR7Jy1iYXNlaHR0cHBvcnQnfSkgewogICAgbXkgJHYgPSAkb3B0eyctYmFzZWh0dHBwb3J0J30gKyAkZGlzcGxheU51bWJlcjsKICAgIHByaW50ICgiTGlzdGVuaW5nIHRvICR2IGZvciBodHRwIGNvbm5lY3Rpb25zLlxuIik7CiAgICAkY21kIC49ICIgLWh0dHBwb3J0ICR2IjsKICB9Cn0KJGNtZCAuPSAiIC1hdXRoICR4YXV0aG9yaXR5RmlsZSI7CmlmICgkZ2VvbWV0cnkpIHsKICBpZiAoJCMkZ2VvbWV0cnk9PS0xKSB7CiAgICAkY21kIC49ICIgLWdlb21ldHJ5ICRnZW9tZXRyeSI7CiAgfSBlbHNlIHsKICAgIGZvcmVhY2ggJGkgKDAuLiQjJGdlb21ldHJ5KSB7CiAgICAgICRjbWQgLj0gIiAtZ2VvbWV0cnkgJGdlb21ldHJ5LT5bJGldIjsKICAgIH0KICB9Cn0KJGNtZCAuPSAiIC1kZXB0aCAkZGVwdGgiIGlmICgkZGVwdGgpOwokY21kIC49ICIgLXBpeGVsZm9ybWF0ICRwaXhlbGZvcm1hdCIgaWYgKCRwaXhlbGZvcm1hdCk7CiRjbWQgLj0gIiAtcmZid2FpdCAzMDAwMCI7CiRjbWQgLj0gIiAtcmZiYXV0aCAkdm5jVXNlckRpci9wYXNzd2QiOwokY21kIC49ICIgLXJmYnBvcnQgJHZuY1BvcnQiOwokY21kIC49ICIgLXBuIjsKCiMgQWRkIGZvbnQgcGF0aCBhbmQgY29sb3IgZGF0YWJhc2Ugc3R1ZmYgaGVyZSwgZS5nLjoKIwojICRjbWQgLj0gIiAtZnAgL3Vzci9saWIvWDExL2ZvbnRzL21pc2MvLC91c3IvbGliL1gxMS9mb250cy83NWRwaS8iOwojICRjbWQgLj0gIiAtY28gL3Vzci9saWIvWDExL3JnYiI7CiMKJGNtZCAuPSAiIC1mcCAkZm9udFBhdGgiIGlmICgkZm9udFBhdGgpOwokY21kIC49ICIgLWNvICRjb2xvclBhdGgiIGlmICgkY29sb3JQYXRoKTsKJGNtZCAuPSAiIC1hbHdheXNzaGFyZWQiIGlmICgkb3B0eyctYWx3YXlzc2hhcmVkJ30pOwokY21kIC49ICIgLW5ldmVyc2hhcmVkIiBpZiAoJG9wdHsnLW5ldmVyc2hhcmVkJ30pOwoKZm9yZWFjaCAkYXJnIChAQVJHVikgewogICAgJGNtZCAuPSAiICIgLiAmcXVvdGVkU3RyaW5nKCRhcmcpOwp9CiRjbWQgLj0gIiA+PiAiIC4gJnF1b3RlZFN0cmluZygkZGVza3RvcExvZykgLiAiIDI+JjEiOwoKIyBSdW4gJGNtZCBhbmQgcmVjb3JkIHRoZSBwcm9jZXNzIElELgoKJHBpZEZpbGUgPSAiJHZuY1VzZXJEaXIvJGhvc3Q6JGRpc3BsYXlOdW1iZXIucGlkIjsKc3lzdGVtKCIkY21kICYgZWNobyBcJCEgPiRwaWRGaWxlIik7CgojIEdpdmUgWHZuYzQgYSBjaGFuY2UgdG8gc3RhcnQgdXAKCnNsZWVwKDMpOyAKCndhcm4gIlxuTmV3ICckZGVza3RvcE5hbWUnIGRlc2t0b3AgaXMgJGhvc3Q6JGRpc3BsYXlOdW1iZXJcblxuIjsKCiMgQ3JlYXRlIHRoZSB1c2VyJ3MgeHN0YXJ0dXAgc2NyaXB0IGlmIG5lY2Vzc2FyeS4KCmlmICghKC1lICIkeHN0YXJ0dXAiKSkgewogICAgd2FybiAiQ3JlYXRpbmcgZGVmYXVsdCBzdGFydHVwIHNjcmlwdCAkeHN0YXJ0dXBcbiI7CiAgICBvcGVuKFhTVEFSVFVQLCAiPiR4c3RhcnR1cCIpOwogICAgcHJpbnQgWFNUQVJUVVAgJGRlZmF1bHRYU3RhcnR1cDsKICAgIGNsb3NlKFhTVEFSVFVQKTsKICAgIGNobW9kIDA3NTUsICIkeHN0YXJ0dXAiOwp9CgojIFJ1biB0aGUgWCBzdGFydHVwIHNjcmlwdC4KCndhcm4gIlN0YXJ0aW5nIGFwcGxpY2F0aW9ucyBzcGVjaWZpZWQgaW4gJHhzdGFydHVwXG4iOwp3YXJuICJMb2cgZmlsZSBpcyAkZGVza3RvcExvZ1xuXG4iOwoKIyBJZiB0aGUgdW5peCBkb21haW4gc29ja2V0IGV4aXN0cyB0aGVuIHVzZSB0aGF0IChESVNQTEFZPTpuKSBvdGhlcndpc2UgdXNlCiMgVENQIChESVNQTEFZPWhvc3Q6bikKCmlmICgtZSAiL3RtcC8uWDExLXVuaXgvWCRkaXNwbGF5TnVtYmVyIiB8fAogICAgLWUgIi91c3Ivc3Bvb2wvc29ja2V0cy9YMTEvJGRpc3BsYXlOdW1iZXIiKQp7CiAgICAkRU5We0RJU1BMQVl9PSAiOiRkaXNwbGF5TnVtYmVyIjsKfSBlbHNlIHsKICAgICRFTlZ7RElTUExBWX09ICIkaG9zdDokZGlzcGxheU51bWJlciI7Cn0KJEVOVntWTkNERVNLVE9QfT0gJGRlc2t0b3BOYW1lOwoKc3lzdGVtKCIkeHN0YXJ0dXAgPj4gIiAuICZxdW90ZWRTdHJpbmcoJGRlc2t0b3BMb2cpIC4gIiAyPiYxICYiKTsKCmV4aXQ7CgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIERlYmlhbiBmdW5jdGlvbnMgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMgSSB0aGFuayBNYW5vaiBmb3IgdGhlIGNvZGUgYmVsb3cuCiMKIyBSZWFkQ29uZmlnRmlsZSByZWFkcyBpbiBhIGNvbmZpZyBmaWxlIGFuZCBzZXRzIHZhcmlhYmxlcyBhY2NvcmRpbmcgdG8gaXQuCiMKCnN1YiBSZWFkQ29uZmlnRmlsZQp7CiAgb3BlbihDT05GSUcsICIkQ29uZmlnX2ZpbGUiKSB8fCByZXR1cm47CiAgbXkgJGxpbmVubyA9IDA7CiAgd2hpbGUgKDxDT05GSUc+KSB7CiAgICAgIGNob21wOwogICAgICAkbGluZW5vKys7CiAgICAgIHMvXCMuKi8vb2c7CiAgICAgIG5leHQgaWYgL15ccyokL29nOwogICAgICAkXyAuPSAiOyIgdW5sZXNzIC87XHMqJC87CiAgICAgIGlmICgvXlxzKihbXj1dKylccyo9XHMqKFxTLiopJC9vKSB7CiAgICAgICAgICBteSAkcmV0ID0gZXZhbCAiJDE9JDIiOwogICAgICAgICAgaWYgKCRAKSB7CiAgICAgICAgICAgICAgcHJpbnQgU1RERVJSICJFcnJvciBwYXJzaW5nIGNvbmZpZyBmaWxlICRDb25maWdfZmlsZSFcbiI7CiAgICAgICAgICAgICAgcHJpbnQgU1RERVJSICIkbGluZW5vOiRfXG4iOwogICAgICAgICAgfQogICAgICB9CiAgfQp9CgpzdWIgUmVhZFhGQ29uZmlnRm9udAp7CiAgb3BlbihDT05GSUcsICIkWEZDb25maWdQYXRoIikgfHwgcmV0dXJuOwogIG15ICRsaW5lbm8gPSAwOwogIHdoaWxlICg8Q09ORklHPikgewogICAgICBjaG9tcDsKICAgICAgJGxpbmVubysrOwogICAgICBzL1wjLiovL29nOwogICAgICBuZXh0IGlmIC9eXHMqJC9vZzsKICAgICAgaWYgKC9eXHMqRm9udFBhdGhccyoiKFxTLiopIlxzKiQvbykgewogICAgICAgICAgJGZvbnRQYXRoIC49ICIsIiBpZiAkZm9udFBhdGg7CiAgICAgICAgICAkZm9udFBhdGggLj0gJDE7CiAgICAgIH0KICB9Cn0KCnN1YiBSZWFkWEZDb25maWdDb2xvcgp7CiAgb3BlbihDT05GSUcsICIkWEZDb25maWdQYXRoIikgfHwgcmV0dXJuOwogIG15ICRsaW5lbm8gPSAwOwogIHdoaWxlICg8Q09ORklHPiAmJiAhJGNvbG9yUGF0aCkgewogICAgICBjaG9tcDsKICAgICAgJGxpbmVubysrOwogICAgICBzL1wjLiovL29nOwogICAgICBuZXh0IGlmIC9eXHMqJC9vZzsKICAgICAgaWYgKC9eXHMqUmdiUGF0aFxzKiIoXFMuKikiXHMqJC9vKSB7CiAgICAgICAgICAkY29sb3JQYXRoID0gJDE7CiAgICAgIH0KICB9Cn0KCgojIyMjIyMjIyMjIEVuZCBvZiBkZWJpYW4gZnVuY3Rpb25zICMjIyMjIyMjIyMjCgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojCiMgQ2hlY2tHZW9tZXRyeUFuZERlcHRoIHNpbXBseSBtYWtlcyBzdXJlIHRoYXQgdGhlIGdlb21ldHJ5IGFuZCBkZXB0aCB2YWx1ZXMKIyBhcmUgc2Vuc2libGUuCiMKCnN1YiBDaGVja0dlb21ldHJ5CnsKICAgbXkgJGdlb21ldHJ5PXNoaWZ0OwogICBpZiAoJGdlb21ldHJ5ID1+IC9eKFxkKyl4KFxkKykkLykgewoJJHdpZHRoID0gJDE7ICRoZWlnaHQgPSAkMjsKCglpZiAoKCR3aWR0aDwxKSB8fCAoJGhlaWdodDwxKSkgewoJICAgIGRpZSAiJHByb2c6IGdlb21ldHJ5ICRnZW9tZXRyeSBpcyBpbnZhbGlkXG4iOwoJfQoKCXdoaWxlICgoJHdpZHRoICUgNCkhPTApIHsKCSAgICAkd2lkdGggPSAkd2lkdGggKyAxOwoJfQoKCXdoaWxlICgoJGhlaWdodCAlIDIpIT0wKSB7CgkgICAgJGhlaWdodCA9ICRoZWlnaHQgKyAxOwoJfQoKCSRnZW9tZXRyeSA9ICIke3dpZHRofXgkaGVpZ2h0IjsKICAgIH0gZWxzZSB7CglkaWUgIiRwcm9nOiBnZW9tZXRyeSAkZ2VvbWV0cnkgaXMgaW52YWxpZFxuIjsKICAgIH0KCn0KCnN1YiBDaGVja0dlb21ldHJ5QW5kRGVwdGgKewoJaWYgKCRnZW9tZXRyeSkgewoJICBpZiAoJCMkZ2VvbWV0cnk9PS0xKSB7CgkgICAgJkNoZWNrR2VvbWV0cnkoJGdlb21ldHJ5KTsKCSAgfSBlbHNlIHsKCQkgZm9yZWFjaCAkaSAoMC4uJCMkZ2VvbWV0cnkpIHsKCQkJJkNoZWNrR2VvbWV0cnkoJGdlb21ldHJ5LT5bJGldKTsKCQkgfQoJICB9Cgl9CiAgICBpZiAoKCRkZXB0aCA8IDgpIHx8ICgkZGVwdGggPiAzMikpIHsKCWRpZSAiRGVwdGggbXVzdCBiZSBiZXR3ZWVuIDggYW5kIDMyXG4iOwogICAgfQp9CgoKIwojIEdldERpc3BsYXlOdW1iZXIgZ2V0cyB0aGUgbG93ZXN0IGF2YWlsYWJsZSBkaXNwbGF5IG51bWJlci4gIEEgZGlzcGxheSBudW1iZXIKIyBuIGlzIHRha2VuIGlmIHNvbWV0aGluZyBpcyBsaXN0ZW5pbmcgb24gdGhlIFZOQyBzZXJ2ZXIgcG9ydCAoNTkwMCtuKSBvciB0aGUKIyBYIHNlcnZlciBwb3J0ICg2MDAwK24pLgojCgpzdWIgR2V0RGlzcGxheU51bWJlcgp7CiAgICBmb3JlYWNoICRuICgxLi45OSkgewoJaWYgKCZDaGVja0Rpc3BsYXlOdW1iZXIoJG4pKSB7CgkgICAgcmV0dXJuICRuKzA7ICMgQnJ1Y2UgTWFoJ3Mgd29ya2Fyb3VuZCBmb3IgYnVnIGluIHBlcmwgNS4wMDVfMDIKCX0KICAgIH0KICAgIAogICAgZGllICIkcHJvZzogbm8gZnJlZSBkaXNwbGF5IG51bWJlciBvbiAkaG9zdC5cbiI7Cn0KCgojCiMgQ2hlY2tEaXNwbGF5TnVtYmVyIGNoZWNrcyBpZiB0aGUgZ2l2ZW4gZGlzcGxheSBudW1iZXIgaXMgYXZhaWxhYmxlLiAgQQojIGRpc3BsYXkgbnVtYmVyIG4gaXMgdGFrZW4gaWYgc29tZXRoaW5nIGlzIGxpc3RlbmluZyBvbiB0aGUgVk5DIHNlcnZlciBwb3J0CiMgKDU5MDArbikgb3IgdGhlIFggc2VydmVyIHBvcnQgKDYwMDArbikuCiMKCnN1YiBDaGVja0Rpc3BsYXlOdW1iZXIKewogICAgbG9jYWwgKCRuKSA9IEBfOwoKICAgIHNvY2tldChTLCAkQUZfSU5FVCwgJFNPQ0tfU1RSRUFNLCAwKSB8fCBkaWUgIiRwcm9nOiBzb2NrZXQgZmFpbGVkOiAkIVxuIjsKICAgIGV2YWwgJ3NldHNvY2tvcHQoUywgJlNPTF9TT0NLRVQsICZTT19SRVVTRUFERFIsIHBhY2soImwiLCAxKSknOwogICAgaWYgKCFiaW5kKFMsIHBhY2soJ1MgbiB4MTInLCAkQUZfSU5FVCwgNjAwMCArICRuKSkpIHsKCWNsb3NlKFMpOwoJcmV0dXJuIDA7CiAgICB9CiAgICBjbG9zZShTKTsKCiAgICBzb2NrZXQoUywgJEFGX0lORVQsICRTT0NLX1NUUkVBTSwgMCkgfHwgZGllICIkcHJvZzogc29ja2V0IGZhaWxlZDogJCFcbiI7CiAgICBldmFsICdzZXRzb2Nrb3B0KFMsICZTT0xfU09DS0VULCAmU09fUkVVU0VBRERSLCBwYWNrKCJsIiwgMSkpJzsKICAgIGlmICghYmluZChTLCBwYWNrKCdTIG4geDEyJywgJEFGX0lORVQsIDU5MDAgKyAkbikpKSB7CgljbG9zZShTKTsKCXJldHVybiAwOwogICAgfQogICAgY2xvc2UoUyk7CgogICAgaWYgKC1lICIvdG1wLy5YJG4tbG9jayIpIHsKCXdhcm4gIlxuV2FybmluZzogJGhvc3Q6JG4gaXMgdGFrZW4gYmVjYXVzZSBvZiAvdG1wLy5YJG4tbG9ja1xuIjsKCXdhcm4gIlJlbW92ZSB0aGlzIGZpbGUgaWYgdGhlcmUgaXMgbm8gWCBzZXJ2ZXIgJGhvc3Q6JG5cbiI7CglyZXR1cm4gMDsKICAgIH0KCiAgICBpZiAoLWUgIi90bXAvLlgxMS11bml4L1gkbiIpIHsKCXdhcm4gIlxuV2FybmluZzogJGhvc3Q6JG4gaXMgdGFrZW4gYmVjYXVzZSBvZiAvdG1wLy5YMTEtdW5peC9YJG5cbiI7Cgl3YXJuICJSZW1vdmUgdGhpcyBmaWxlIGlmIHRoZXJlIGlzIG5vIFggc2VydmVyICRob3N0OiRuXG4iOwoJcmV0dXJuIDA7CiAgICB9CgogICAgaWYgKC1lICIvdXNyL3Nwb29sL3NvY2tldHMvWDExLyRuIikgewoJd2FybigiXG5XYXJuaW5nOiAkaG9zdDokbiBpcyB0YWtlbiBiZWNhdXNlIG9mICIuCiAgICAgICAgICAgICAiL3Vzci9zcG9vbC9zb2NrZXRzL1gxMS8kblxuIik7Cgl3YXJuICJSZW1vdmUgdGhpcyBmaWxlIGlmIHRoZXJlIGlzIG5vIFggc2VydmVyICRob3N0OiRuXG4iOwoJcmV0dXJuIDA7CiAgICB9CgogICAgcmV0dXJuIDE7Cn0KCgojCiMgR2V0WERpc3BsYXlEZWZhdWx0cyB1c2VzIHhkcHlpbmZvIHRvIGZpbmQgb3V0IHRoZSBnZW9tZXRyeSwgZGVwdGggYW5kIHBpeGVsCiMgZm9ybWF0IG9mIHRoZSBjdXJyZW50IFggZGlzcGxheSBiZWluZyB1c2VkLiAgSWYgc3VjY2Vzc2Z1bCwgaXQgc2V0cyB0aGUKIyBvcHRpb25zIGFzIGFwcHJvcHJpYXRlIHNvIHRoYXQgdGhlIFggVk5DIHNlcnZlciB3aWxsIHVzZSB0aGUgc2FtZSBzZXR0aW5ncwojIChtaW51cyBhbiBhbGxvd2FuY2UgZm9yIHdpbmRvdyBtYW5hZ2VyIGRlY29yYXRpb25zIG9uIHRoZSBnZW9tZXRyeSkuICBVc2luZwojIHRoZSBzYW1lIGRlcHRoIGFuZCBwaXhlbCBmb3JtYXQgbWVhbnMgdGhhdCB0aGUgVk5DIHNlcnZlciB3b24ndCBoYXZlIHRvCiMgdHJhbnNsYXRlIHBpeGVscyB3aGVuIHRoZSBkZXNrdG9wIGlzIGJlaW5nIHZpZXdlZCBvbiB0aGlzIFggZGlzcGxheSAoZm9yCiMgVHJ1ZUNvbG9yIGRpc3BsYXlzIGFueXdheSkuCiMKCnN1YiBHZXRYRGlzcGxheURlZmF1bHRzCnsKICAgIGxvY2FsIChAbGluZXMsIEBtYXRjaGxpbmVzLCAkd2lkdGgsICRoZWlnaHQsICRkZWZhdWx0VmlzdWFsSWQsICRpLAoJICAgJHJlZCwgJGdyZWVuLCAkYmx1ZSk7CgogICAgJHdtRGVjb3JhdGlvbldpZHRoID0gNDsJIyBhIGd1ZXNzIGF0IHR5cGljYWwgc2l6ZSBmb3Igd2luZG93IG1hbmFnZXIKICAgICR3bURlY29yYXRpb25IZWlnaHQgPSAyNDsJIyBkZWNvcmF0aW9uIHNpemUKCiAgICByZXR1cm4gaWYgKCFkZWZpbmVkKCRFTlZ7RElTUExBWX0pKTsKCiAgICBAbGluZXMgPSBgeGRweWluZm8gMj4vZGV2L251bGxgOwoKICAgIHJldHVybiBpZiAoJD8gIT0gMCk7CgogICAgQG1hdGNobGluZXMgPSBncmVwKC9kaW1lbnNpb25zLywgQGxpbmVzKTsKICAgIGlmIChAbWF0Y2hsaW5lcykgewoJKCR3aWR0aCwgJGhlaWdodCkgPSAoJG1hdGNobGluZXNbMF0gPX4gLyhcZCspeChcZCspIHBpeGVscy8pOwoKCSR3aWR0aCAtPSAkd21EZWNvcmF0aW9uV2lkdGg7CgkkaGVpZ2h0IC09ICR3bURlY29yYXRpb25IZWlnaHQ7CgoJJGdlb21ldHJ5ID0gIiR7d2lkdGh9eCRoZWlnaHQiOwogICAgfQoKICAgIEBtYXRjaGxpbmVzID0gZ3JlcCgvZGVmYXVsdCB2aXN1YWwgaWQvLCBAbGluZXMpOwogICAgaWYgKEBtYXRjaGxpbmVzKSB7CgkoJGRlZmF1bHRWaXN1YWxJZCkgPSAoJG1hdGNobGluZXNbMF0gPX4gL2lkOlxzKyhcUyspLyk7CgoJZm9yICgkaSA9IDA7ICRpIDwgQGxpbmVzOyAkaSsrKSB7CgkgICAgaWYgKCRsaW5lc1skaV0gPX4gL15ccyp2aXN1YWwgaWQ6XHMrJGRlZmF1bHRWaXN1YWxJZCQvKSB7CgkJaWYgKCgkbGluZXNbJGkrMV0gIX4gL1RydWVDb2xvci8pIHx8CgkJICAgICgkbGluZXNbJGkrMl0gIX4gL2RlcHRoLykgfHwKCQkgICAgKCRsaW5lc1skaSs0XSAhfiAvcmVkLCBncmVlbiwgYmx1ZSBtYXNrcy8pKQoJCXsKCQkgICAgcmV0dXJuOwoJCX0KCQlsYXN0OwoJICAgIH0KCX0KCglyZXR1cm4gaWYgKCRpID49IEBsaW5lcyk7CgoJKCRkZXB0aCkgPSAoJGxpbmVzWyRpKzJdID1+IC9kZXB0aDpccysoXGQrKS8pOwoJKCRyZWQsJGdyZWVuLCRibHVlKQoJICAgID0gKCRsaW5lc1skaSs0XQoJICAgICAgID1+IC9tYXNrczpccysweChbMC05YS1mXSspLCAweChbMC05YS1mXSspLCAweChbMC05YS1mXSspLyk7CgoJJHJlZCA9IGhleCgkcmVkKTsKCSRncmVlbiA9IGhleCgkZ3JlZW4pOwoJJGJsdWUgPSBoZXgoJGJsdWUpOwoKCWlmICgkcmVkID4gJGJsdWUpIHsKCSAgICAkcmVkID0gaW50KGxvZygkcmVkKSAvIGxvZygyKSkgLSBpbnQobG9nKCRncmVlbikgLyBsb2coMikpOwoJICAgICRncmVlbiA9IGludChsb2coJGdyZWVuKSAvIGxvZygyKSkgLSBpbnQobG9nKCRibHVlKSAvIGxvZygyKSk7CgkgICAgJGJsdWUgPSBpbnQobG9nKCRibHVlKSAvIGxvZygyKSkgKyAxOwoJICAgICRwaXhlbGZvcm1hdCA9ICJyZ2IkcmVkJGdyZWVuJGJsdWUiOwoJfSBlbHNlIHsKCSAgICAkYmx1ZSA9IGludChsb2coJGJsdWUpIC8gbG9nKDIpKSAtIGludChsb2coJGdyZWVuKSAvIGxvZygyKSk7CgkgICAgJGdyZWVuID0gaW50KGxvZygkZ3JlZW4pIC8gbG9nKDIpKSAtIGludChsb2coJHJlZCkgLyBsb2coMikpOwoJICAgICRyZWQgPSBpbnQobG9nKCRyZWQpIC8gbG9nKDIpKSArIDE7CgkgICAgJHBpeGVsZm9ybWF0ID0gImJnciRibHVlJGdyZWVuJHJlZCI7Cgl9CiAgICB9Cn0KCgojCiMgcXVvdGVkU3RyaW5nIHJldHVybnMgYSBzdHJpbmcgd2hpY2ggeWllbGRzIHRoZSBvcmlnaW5hbCBzdHJpbmcgd2hlbiBwYXJzZWQKIyBieSBhIHNoZWxsLgojCgpzdWIgcXVvdGVkU3RyaW5nCnsKICAgIGxvY2FsICgkaW4pID0gQF87CgogICAgJGluID1+IHMvXCcvXCdcIlwnXCJcJy9nOwoKICAgIHJldHVybiAiJyRpbiciOwp9CgoKIwojIHJlbW92ZVNsYXNoZXMgdHVybnMgc2xhc2hlcyBpbnRvIHVuZGVyc2NvcmVzIGZvciB1c2UgYXMgYSBmaWxlIG5hbWUuCiMKCnN1YiByZW1vdmVTbGFzaGVzCnsKICAgIGxvY2FsICgkaW4pID0gQF87CgogICAgJGluID1+IHN8L3xffGc7CgogICAgcmV0dXJuICIkaW4iOwp9CgoKIwojIFVzYWdlCiMKCnN1YiBVc2FnZQp7CiAgICBkaWUoIlZOQzQgc2VydmVyXG4iLgogICAgICAgIlxuIi4KICAgICAgICJVc2FnZTogJHByb2cgWzxPUFRJT05TPl0gWzo8RElTUExBWSM+XVxuIi4KICAgICAgICIgICAgICAgJHByb2cgLWtpbGwgOjxESVNQTEFZIz5cbiIuCiAgICAgICAiXG4iLgogICAgICAgIjxPUFRJT05TPiBhcmUgWHZuYzQgb3B0aW9ucywgb3I6XG4iLgogICAgICAgIlxuIi4KICAgICAgICIgICAgICAgIC1uYW1lIDxERVNLVE9QLU5BTUU+XG4iLgogICAgICAgIiAgICAgICAgLWRlcHRoIDxERVBUSD5cbiIuCiAgICAgICAiICAgICAgICAtZ2VvbWV0cnkgPFdJRFRIPng8SEVJR0hUPlxuIi4KICAgICAgICIgICAgICAgIC1odHRwcG9ydCBudW1iZXJcbiIuCiAgICAgICAiICAgICAgICAtYmFzZWh0dHBwb3J0IG51bWJlclxuIi4KICAgICAgICIgICAgICAgIC1hbHdheXNzaGFyZWRcbiIuCiAgICAgICAiICAgICAgICAtbmV2ZXJzaGFyZWRcbiIuCiAgICAgICAiICAgICAgICAtcGl4ZWxmb3JtYXQgcmdiPE5OTj5cbiIuCiAgICAgICAiICAgICAgICAtcGl4ZWxmb3JtYXQgYmdyPE5OTj5cbiIuCiAgICAgICAiICAgICAgICA8WHZuYzQtb3B0aW9ucz4uLi5cbiIuCiAgICAgICAiXG4iLgogICAgICAgIlNlZSB2bmM0c2VydmVyIGFuZCBYdm5jNCBtYW51YWwgcGFnZXMgZm9yIG1vcmUgaW5mb3JtYXRpb24uXG4iKTsKfQoKCiMKIyBLaWxsCiMKCnN1YiBLaWxsCnsKICAgICRvcHR7Jy1raWxsJ30gPX4gcy8oOlxkKylcLlxkKyQvJDEvOyAjIGUuZy4gdHVybiA6MS4wIGludG8gOjEKCiAgICBpZiAoJG9wdHsnLWtpbGwnfSA9fiAvXjpcZCskLykgewoJJHBpZEZpbGUgPSAiJHZuY1VzZXJEaXIvJGhvc3Qkb3B0eycta2lsbCd9LnBpZCI7CiAgICB9IGVsc2UgewoJaWYgKCRvcHR7Jy1raWxsJ30gIX4gL14kaG9zdDovKSB7CgkgICAgZGllICJcbkNhbid0IHRlbGwgaWYgJG9wdHsnLWtpbGwnfSBpcyBvbiAkaG9zdFxuIi4KCQkiVXNlIC1raWxsIDo8bnVtYmVyPiBpbnN0ZWFkXG5cbiI7Cgl9CgkkcGlkRmlsZSA9ICIkdm5jVXNlckRpci8kb3B0eycta2lsbCd9LnBpZCI7CiAgICB9CgogICAgaWYgKCEgLXIgJHBpZEZpbGUpIHsKCWRpZSAiXG5DYW4ndCBmaW5kIGZpbGUgJHBpZEZpbGVcbiIuCgkgICAgIllvdSdsbCBoYXZlIHRvIGtpbGwgdGhlIFh2bmM0IHByb2Nlc3MgbWFudWFsbHlcblxuIjsKICAgIH0KCiAgICAkU0lHeydIVVAnfSA9ICdJR05PUkUnOwogICAgY2hvcCgkcGlkID0gYGNhdCAkcGlkRmlsZWApOwogICAgd2FybiAiS2lsbGluZyBYdm5jNCBwcm9jZXNzIElEICRwaWRcbiI7CiAgICBzeXN0ZW0oImtpbGwgJHBpZCIpOwogICAgdW5saW5rICRwaWRGaWxlOwogICAgZXhpdDsKfQoKCiMKIyBQYXJzZU9wdGlvbnMgdGFrZXMgYSBsaXN0IG9mIHBvc3NpYmxlIG9wdGlvbnMgYW5kIGEgYm9vbGVhbiBpbmRpY2F0aW5nCiMgd2hldGhlciB0aGUgb3B0aW9uIGhhcyBhIHZhbHVlIGZvbGxvd2luZywgYW5kIHNldHMgdXAgYW4gYXNzb2NpYXRpdmUgYXJyYXkKIyAlb3B0IG9mIHRoZSB2YWx1ZXMgb2YgdGhlIG9wdGlvbnMgZ2l2ZW4gb24gdGhlIGNvbW1hbmQgbGluZS4gSXQgcmVtb3ZlcyBhbGwKIyB0aGUgYXJndW1lbnRzIGl0IHVzZXMgZnJvbSBAQVJHViBhbmQgcmV0dXJucyB0aGVtIGluIEBvcHRBcmdzLgojCgpzdWIgUGFyc2VPcHRpb25zCnsKICAgIGxvY2FsIChAb3B0dmFsKSA9IEBfOwogICAgbG9jYWwgKCRvcHQsIEBvcHRzLCAldmFsRm9sbG93cywgQG5ld2FyZ3MpOwoKICAgIHdoaWxlIChAb3B0dmFsKSB7Cgkkb3B0ID0gc2hpZnQoQG9wdHZhbCk7CglwdXNoKEBvcHRzLCRvcHQpOwoJJHZhbEZvbGxvd3N7JG9wdH0gPSBzaGlmdChAb3B0dmFsKTsKICAgIH0KCiAgICBAb3B0QXJncyA9ICgpOwogICAgJW9wdCA9ICgpOwoKICAgIGFyZzogd2hpbGUgKGRlZmluZWQoJGFyZyA9IHNoaWZ0KEBBUkdWKSkpIHsKCWZvcmVhY2ggJG9wdCAoQG9wdHMpIHsKCSAgICBpZiAoJGFyZyBlcSAkb3B0KSB7CgkJcHVzaChAb3B0QXJncywgJGFyZyk7CgkJaWYgKCR2YWxGb2xsb3dzeyRvcHR9KSB7CgkJICAgIGlmIChAQVJHViA9PSAwKSB7CgkJCSZVc2FnZSgpOwoJCSAgICB9CgkJICAgIGlmICgkb3B0eyRvcHR9KSB7CgkJICAgICAgICMgQ29udmVydCBzY2FsYXIgdG8gYXJyYXkgaWYgbmVjZXNzYXJ5CgkJICAgICAgICRvcHR7JG9wdH0gPSBbJG9wdHskb3B0fV0gaWYgJCN7JG9wdHskb3B0fX09PS0xOwoJCSAgICAgICBwdXNoKEB7JG9wdHskb3B0fX0sc2hpZnQoQEFSR1YpKTsKCQkgICAgfSBlbHNlIHsKCQkgICAgICAgJG9wdHskb3B0fSA9IHNoaWZ0KEBBUkdWKTsKCQkgICAgfQoJCSAgICBwdXNoKEBvcHRBcmdzLCAkb3B0eyRvcHR9KTsKCQl9IGVsc2UgewoJCSAgICAkb3B0eyRvcHR9ID0gMTsKCQl9CgkJbmV4dCBhcmc7CgkgICAgfQoJfQoJcHVzaChAbmV3YXJncywkYXJnKTsKICAgIH0KCiAgICBAQVJHViA9IEBuZXdhcmdzOwp9CgoKIwojIFJvdXRpbmUgdG8gbWFrZSBzdXJlIHdlJ3JlIG9wZXJhdGluZyBpbiBhIHNhbmUgZW52aXJvbm1lbnQuCiMKCnN1YiBTYW5pdHlDaGVjawp7CiAgICBsb2NhbCAoJGNtZCk7CgogICAgIwogICAgIyBHZXQgdGhlIHByb2dyYW0gbmFtZQogICAgIwoKICAgICgkcHJvZykgPSAoJDAgPX4gbXwoW14vXSspJHwpOwoKICAgICMKICAgICMgQ2hlY2sgd2UgaGF2ZSBhbGwgdGhlIGNvbW1hbmRzIHdlJ2xsIG5lZWQgb24gdGhlIHBhdGguCiAgICAjCgogY21kOgogICAgZm9yZWFjaCAkY21kICgidW5hbWUiLCJ4YXV0aCIsIlh2bmM0Iiwidm5jcGFzc3dkIikgewoJZm9yIChzcGxpdCgvOi8sJEVOVntQQVRIfSkpIHsKCSAgICBpZiAoLXggIiRfLyRjbWQiKSB7CgkJbmV4dCBjbWQ7CgkgICAgfQoJfQoJZGllICIkcHJvZzogY291bGRuJ3QgZmluZCBcIiRjbWRcIiBvbiB5b3VyIFBBVEguXG4iOwogICAgfQoKICAgICMKICAgICMgQ2hlY2sgdGhlIEhPTUUgZW52aXJvbm1lbnQgdmFyaWFibGUgaXMgc2V0CiAgICAjCgogICAgaWYgKCFkZWZpbmVkKCRFTlZ7SE9NRX0pKSB7CglkaWUgIiRwcm9nOiBUaGUgSE9NRSBlbnZpcm9ubWVudCB2YXJpYWJsZSBpcyBub3Qgc2V0LlxuIjsKICAgIH0KICAgIGNoZGlyKCRFTlZ7SE9NRX0pOwoKICAgICMKICAgICMgRmluZCBzb2NrZXQgY29uc3RhbnRzLiAndXNlIFNvY2tldCcgaXMgYSBwZXJsNS1pc20sIHNvIHdlIHdyYXAgaXQgaW4gYW4KICAgICMgZXZhbCwgYW5kIGlmIGl0IGZhaWxzIHdlIHRyeSAncmVxdWlyZSAic3lzL3NvY2tldC5waCInLiAgSWYgdGhpcyBmYWlscywKICAgICMgd2UganVzdCBndWVzcyBhdCB0aGUgdmFsdWVzLiAgSWYgeW91IGZpbmQgcGVybCBtb2FuaW5nIGhlcmUsIGp1c3QKICAgICMgaGFyZC1jb2RlIHRoZSB2YWx1ZXMgb2YgQUZfSU5FVCBhbmQgU09DS19TVFJFQU0uICBZb3UgY2FuIGZpbmQgdGhlc2Ugb3V0CiAgICAjIGZvciB5b3VyIHBsYXRmb3JtIGJ5IGxvb2tpbmcgaW4gL3Vzci9pbmNsdWRlL3N5cy9zb2NrZXQuaCBhbmQgcmVsYXRlZAogICAgIyBmaWxlcy4KICAgICMKCiAgICBjaG9wKCRvcyA9IGB1bmFtZWApOwogICAgY2hvcCgkb3NyZXYgPSBgdW5hbWUgLXJgKTsKCiAgICBldmFsICd1c2UgU29ja2V0JzsKICAgIGlmICgkQCkgewoJZXZhbCAncmVxdWlyZSAic3lzL3NvY2tldC5waCInOwoJaWYgKCRAKSB7CgkgICAgaWYgKCgkb3MgZXEgIlN1bk9TIikgJiYgKCRvc3JldiAhfiAvXjQvKSkgewoJCSRBRl9JTkVUID0gMjsKCQkkU09DS19TVFJFQU0gPSAyOwoJICAgIH0gZWxzZSB7CgkJJEFGX0lORVQgPSAyOwoJCSRTT0NLX1NUUkVBTSA9IDE7CgkgICAgfQoJfSBlbHNlIHsKCSAgICAkQUZfSU5FVCA9ICZBRl9JTkVUOwoJICAgICRTT0NLX1NUUkVBTSA9ICZTT0NLX1NUUkVBTTsKCX0KICAgIH0gZWxzZSB7CgkkQUZfSU5FVCA9ICZBRl9JTkVUOwoJJFNPQ0tfU1RSRUFNID0gJlNPQ0tfU1RSRUFNOwogICAgfQp9'
sudo chmod 775 /usr/bin/vncserver
sudo vncserver